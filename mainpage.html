<html>
	<head>
		<meta charset = "utf-8">
		<!--BOOTSTRAP & FONTS-->
		<link href='http://fonts.googleapis.com/css?family=Alegreya+Sans:400,300,500' rel='stylesheet' type='text/css'>
		<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700' rel='stylesheet' type='text/css'>
	    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
	    <link href="bootstrap/css/dashboard.css" rel="stylesheet">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
	    <!--FIREPAD-->
		 <script src="https://cdn.firebase.com/v0/firebase.js"></script>
  		<script src="https://cdn.firebase.com/v0/firebase-simple-login.js"></script>

	    <link rel="stylesheet" href="firepad/firepad.css">
	    <link rel="stylesheet" href="firechat/firechat-default.css">
	    <link rel="stylesheet" href="codemirror/lib/codemirror.css" />
	    <!--OPENTOK-->
		<script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js" ></script>        <script src="codemirror/mode/javascript/javascript.js"></script>
	    <script src="codemirror/lib/codemirror.js"></script>
	    <script src="firepad/firepad.js"></script>
	    <script src="firechat/firechat-default.js"></script>
		<!--CUSTOM PAGE CSS -->
	    <link href = "mainpage.css" rel = "stylesheet">
	    <link href = "firechat-overload.css" rel = "stylesheet">
	    <style type = "text/css">
	    .navbar a
	    {
	    	color:white !important;
	    }
	    .navbar a:hover
	    {
	    	color:#7D7D7D !important;
	    }
	    </style>

	</head>
	<body>
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation" style = "background-color:#5cb85c;">
      <div class="container-fluid">
        <div  class="navbar-header">
          <a class="navbar-brand"  href="#">Class: </a>
        </div>
        <div  class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#">Dashboard</a></li>
            <li><a href="#">Settings</a></li>
            <li><a href="#">Profile</a></li>
            <li><a href="#">Help</a></li>
            </ul>
        </div>
      </div>
    </div>
		<h1 class = "page-header" style = "text-align:center;">Welcome to class: </h1> <!-- LOAD CLASSNAME FROM PHP TABLES-->
		<div id = "tokbox"> </div>
		<h3 id = "write-some-code" style = "display:inline; margin-left: 17%;"> Write some code!</h3>
		<h3 id = "write-some-code" style = "display:inline; margin-left: 400px;"> Chat with your classmates.</h3>
		<div id ="firepad"></div>
		<div id = "firechat-wrapper"> </div>


 	<script type='text/javascript'>
		       var chatRef = new Firebase('https://firechat-demo.firebaseio.com');
    var chat = new FirechatUI(chatRef, document.getElementById("firechat-wrapper"));
    var simpleLogin = new FirebaseSimpleLogin(chatRef, function(err, user) {
      if (user) {
        chat.setUser(user.id, 'Anonymous' + user.id.substr(0, 8));
        setTimeout(function() {
          chat._chat.enterRoom('-Iy1N3xs4kN8iALHV0QA');
        }, 500);
      } else {
        simpleLogin.login('anonymous');    
      }
    });
  	</script>
    <script type = "text/javascript">
      var firepadRef = new Firebase('http://codium.firebaseio.com');
      var codeMirror = CodeMirror(document.getElementById('firepad'), { lineNumbers: true, mode: 'javascript'});
      var firepad = Firepad.fromCodeMirror(firepadRef, codeMirror);
     
    </script>
    <script type="text/javascript">
			
			  var apiKey    = "44698282";
			  var sessionId = "1_MX40NDY5ODI4Mn5-U2F0IE1hciAyMiAxNDozMToxMSBQRFQgMjAxNH4wLjU3MDgyNDR-";
			  var token     = "T1==cGFydG5lcl9pZD00NDY5ODI4MiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz1jMWMxMDU3MDYyZjk4OTdmOWRmMzViMmQxY2FlYjE4ZjU4ZDA4MjBhOnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9MV9NWDQwTkRZNU9ESTRNbjUtVTJGMElFMWhjaUF5TWlBeE5Eb3pNVG94TVNCUVJGUWdNakF4Tkg0d0xqVTNNRGd5TkRSLSZjcmVhdGVfdGltZT0xMzk1NTI2MjQxJm5vbmNlPTAuMzQ0MTkyNjUwMzExOTg2ODcmZXhwaXJlX3RpbWU9MTM5NTUyOTgyMCZjb25uZWN0aW9uX2RhdGE9"; //generate from PHP script
			 
			  function sessionConnectedHandler (event) {
			  	//wrap this code in "if is teacher"
			     session.publish(publisher); 
			     subscribeToStreams(event.streams);
			  }
			  function subscribeToStreams(streams) {
			    for (var i = 0; i < streams.length; i++) {
			        var stream = streams[i];
			        if (stream.connection.connectionId
			               != session.connection.connectionId) {
			        	//wrap this code in if isn't teacher
			            session.subscribe(stream, {width:700, height:700});
			        }
			    }
			  }
			  function streamCreatedHandler(event) {
			    subscribeToStreams(event.streams);
			  }
			 
			  var publisher = TB.initPublisher(apiKey,  "tokbox");
			  var session   = TB.initSession(sessionId);
			 
			  session.connect(apiKey, token);
			  session.addEventListener("sessionConnected",
			                           sessionConnectedHandler);
			 
			  session.addEventListener("streamCreated",
			                           streamCreatedHandler);

		</script>
		 
	</body>
</html>
